{% extends 'dashboard/base.html' %}

{% block content %}
<div class="dashboard-container">
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-chart-line me-2"></i>Monthly Report</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="monthPicker" class="form-label">Select Month</label>
                                <div class="input-group">
                                    <input type="month" class="form-control" id="monthPicker" value="2023-08">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="reportFormat" class="form-label">Report Format</label>
                                <select class="form-select" id="reportFormat">
                                    <option value="html">HTML</option>
                                    <option value="pdf">PDF</option>
                                    <option value="csv">CSV</option>
                                    <option value="json">JSON</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button class="btn btn-primary w-100">
                                <i class="fas fa-sync-alt me-2"></i>Generate Report
                            </button>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h3 class="text-primary mb-2">64,580</h3>
                                    <p class="text-muted mb-0">Total Requests</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h3 class="text-danger mb-2">872</h3>
                                    <p class="text-muted mb-0">Detected Anomalies</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h3 class="text-warning mb-2">1.4%</h3>
                                    <p class="text-muted mb-0">Anomaly Rate</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h3 class="text-success mb-2">98.6%</h3>
                                    <p class="text-muted mb-0">Normal Traffic</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Monthly Traffic and Anomaly Trend</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="monthlyTrend" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Anomaly Types</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="anomalyTypes" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Most Targeted Endpoints</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Endpoint</th>
                                                <th>Number of Anomalies</th>
                                                <th>Rate</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>/api/users</td>
                                                <td>245</td>
                                                <td>28.1%</td>
                                            </tr>
                                            <tr>
                                                <td>/api/login</td>
                                                <td>187</td>
                                                <td>21.4%</td>
                                            </tr>
                                            <tr>
                                                <td>/admin/config</td>
                                                <td>156</td>
                                                <td>17.9%</td>
                                            </tr>
                                            <tr>
                                                <td>/api/products</td>
                                                <td>98</td>
                                                <td>11.2%</td>
                                            </tr>
                                            <tr>
                                                <td>/api/payments</td>
                                                <td>89</td>
                                                <td>10.2%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Most Attacking IPs</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>IP Address</th>
                                                <th>Number of Anomalies</th>
                                                <th>Block Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>192.168.1.105</td>
                                                <td>178</td>
                                                <td><span class="badge bg-success">Blocked</span></td>
                                            </tr>
                                            <tr>
                                                <td>192.168.1.108</td>
                                                <td>145</td>
                                                <td><span class="badge bg-success">Blocked</span></td>
                                            </tr>
                                            <tr>
                                                <td>192.168.1.120</td>
                                                <td>92</td>
                                                <td><span class="badge bg-success">Blocked</span></td>
                                            </tr>
                                            <tr>
                                                <td>192.168.1.115</td>
                                                <td>87</td>
                                                <td><span class="badge bg-danger">Not Blocked</span></td>
                                            </tr>
                                            <tr>
                                                <td>192.168.1.130</td>
                                                <td>73</td>
                                                <td><span class="badge bg-danger">Not Blocked</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Monthly Trend chart
        const trendCtx = document.getElementById('monthlyTrend').getContext('2d');
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 31}, (_, i) => i + 1),
                datasets: [
                    {
                        label: 'Traffic',
                        data: [
                            2100, 2200, 2150, 2050, 2100, 1900, 1800,
                            2050, 2100, 2250, 2300, 2400, 2350, 2300,
                            2250, 2300, 2350, 2400, 2450, 2350, 2300,
                            2200, 2100, 2050, 2000, 1950, 1900, 2000,
                            2100, 2150, 2200
                        ],
                        borderColor: '#0f62fe',
                        backgroundColor: 'rgba(15, 98, 254, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Anomalies',
                        data: [
                            28, 32, 30, 27, 29, 25, 24,
                            27, 29, 32, 33, 35, 34, 33,
                            32, 33, 34, 35, 36, 34, 33,
                            31, 29, 28, 27, 26, 25, 27,
                            29, 30, 31
                        ],
                        borderColor: '#da1e28',
                        backgroundColor: 'rgba(218, 30, 40, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Traffic'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Anomalies'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        // Anomaly Types chart
        const typesCtx = document.getElementById('anomalyTypes').getContext('2d');
        new Chart(typesCtx, {
            type: 'doughnut',
            data: {
                labels: ['SQL Injection', 'XSS', 'Path Traversal', 'DoS', 'Excessive Requests', 'Other'],
                datasets: [{
                    data: [245, 187, 156, 98, 89, 97],
                    backgroundColor: [
                        '#da1e28',
                        '#ff832b',
                        '#0f62fe',
                        '#8a3ffc',
                        '#24a148',
                        '#6f6f6f'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    });
</script>
{% endblock %} 